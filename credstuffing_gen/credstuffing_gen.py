#!/usr/bin/python3
import sys

users = []
class User:
    def __init__(self, email, passwords):
        self.email = email
        self.passwords = passwords
        users.append(self)


def main():
    if len(sys.argv) != 4:
        print('''
PW formats:user:password, manual, separate
  user:password
    Example
      user1:password1
      user1:password2
      user2:password1
      user2:password2
  manual
    Example
       ++++++++++++++++++++++++ user1 ++++++++++++++++++++++++
       password 1
       password 2
       ++++++++++++++++++++++++ user2 +++++++++++++++++++++++++
       password 1
       password 2
usage: python credstuffing_gen.py path/to/dehashed.csv pw_format /path/to/saved/output
        ''')
    else:
        with open(sys.argv[1], 'r') as f:
            count = 0
            for line in f:
                if count != 0:
                    line = line.split(",")
                    email = line[0]
                    email = email.split('"')
                    email = email[1]
                    password = line[3]
                    new_user = True
                    password = password.split('"')
                    password = password[1]
                    if len(password) > 0:
                        for user in users:
                            if user.email == email:
                                new_user = False
                                if password not in user.passwords:
                                    user.passwords.append(password)
                        if new_user:
                            password = [password]
                            newuser = User(email, password)
                count = count +1
        with open(sys.argv[3], 'w') as f:
            if sys.argv[2] == "manual":
                for user in users:
                    print("++++++++++++++++++++++++++++{}++++++++++++++++++++++++++++++++".format(user.email))
                    f.write("++++++++++++++++++++++++++++{}++++++++++++++++++++++++++++++++\n".format(user.email))
                    for password in user.passwords:
                        print(password)
                        f.write("{}\n".format(password))
            elif sys.argv[2] == "user:password":
                for user in users:
                    for password in user.passwords:
                        print("{}:{}".format(user.email, password))
                        f.write("{}:{}\n".format(user.email, password))


if __name__ == "__main__":
    main()
